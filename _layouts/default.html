<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
        <meta name="description" content="{{ site.description }}">
        <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
        <link rel="stylesheet" href="{{ '/assets/css/all.min.css' | relative_url }}">
    </head>
    <body>
        <!-- Hamburger Menu -->
        <button class="hamburger" id="hamburger" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <!-- Sidebar Overlay (for mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Use post-layout class for posts -->
        <div class="{% if page.layout == 'post' %}post-layout{% else %}site-wrapper{% endif %}">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">
                        <svg class="potato-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M3 4L9.2 20L12 13.2L14.8 20L21 4" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        vimOS
                    </div>

                    <!-- GitHub Repository Card -->
                    <div class="repo-card">
                        <div class="repo-header">Repository</div>
                        <div class="repo-content">
                            <a href="https://github.com/saeeedhany/vimOS" class="repo-name" target="_blank" rel="noopener">
                                <svg class="repo-icon" height="16" width="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
                                </svg>
                                saeeedhany/vimOS
                            </a>
                            <div class="repo-description">Building vimOS on RISC-V</div>
                            <div class="repo-stats">
                                <a href="https://github.com/saeeedhany/vimOS/stargazers" class="repo-stat-link" target="_blank" rel="noopener">
                                    <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"></path>
                                    </svg>
                                    <span id="repo-stars">--</span>
                                </a>
                                <a href="https://github.com/saeeedhany/vimOS/forks" class="repo-stat-link" target="_blank" rel="noopener">
                                    <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path>
                                    </svg>
                                    <span id="repo-forks">--</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <nav>
                    <ul>
                        <li><a href="{{ '/' | relative_url }}" {% if page.url == '/' %}class="active"{% endif %}>~/home</a></li>
                        <li><a href="{{ '/posts' | relative_url }}" {% if page.url == '/posts/' or page.layout == 'post' %}class="active"{% endif %}>~/posts</a></li>
                    </ul>
                </nav>

                <div class="social-links">
                    <h3>Connect</h3>
                    <a href="https://saeeedhany.github.io/saeed/" class="social-link" target="_blank" rel="noopener">
                        <svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        Website
                    </a>
                    <a href="https://forum.osdev.org/" class="social-link" target="_blank" rel="noopener">
                        <svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            <path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM3.5 8a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z"/>
                        </svg>
                        OSDev Forum
                    </a>
                    <a href="https://vimos.org" class="social-link" target="_blank" rel="noopener">
                        <svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M6.167 8a.831.831 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661zm1.843 3.647c.315 0 1.403-.038 1.976-.611a.232.232 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61z"/>
                            <path d="M9.028 8.83a.83.83 0 1 0 0-1.66.83.83 0 0 0 0 1.66z"/>
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.203.203 0 0 0-.153.028.186.186 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224c-.02.115-.029.23-.029.353 0 1.795 2.091 3.256 4.669 3.256 2.577 0 4.668-1.451 4.668-3.256 0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165z"/>
                        </svg>
                        vimos.org
                    </a>
                </div>

                <!-- Table of Contents for posts/notes (sidebar version for mobile/tablet) -->
                {% if page.layout == 'post' %}
                <div class="toc" id="toc">
                    <h3>On This Page</h3>
                    <ul id="toc-list"></ul>
                </div>
                {% endif %}

                <button id="theme-toggle" class="theme-toggle">[light]</button>
            </aside>

            <!-- Main Content -->
            <div class="main-content">
                <main>
                {{ content }}
                </main>
                <footer>
                    <p>Â© 2025 <strong><a href="https://saeeedhany.github.io/saeed/">Saeed</a></strong>. All rights reserved.</p>
                    <p>Building vimOS on RISC-V</p>
                </footer>
            </div>

            <!-- Right TOC - ONLY for posts/notes, AS A SIBLING to main-content -->
            {% if page.layout == 'post' %}
            <aside class="right-toc" id="right-toc">
                <h3>On This Page</h3>
                <ul id="right-toc-list"></ul>
            </aside>

            <script>
            // Generate TOC from headings
            function generateTOC() {
            const content = document.getElementById('post-content');
            const rightTocList = document.getElementById('right-toc-list');
            const sidebarTocList = document.getElementById('toc-list');

if (!content) return;

const headings = content.querySelectorAll('h2, h3');

if (headings.length === 0) {
const rightToc = document.getElementById('right-toc');
const sidebarToc = document.getElementById('toc');
if (rightToc) rightToc.style.display = 'none';
if (sidebarToc) sidebarToc.style.display = 'none';
return;
}

let tocHTML = '';
let currentH2 = null;

headings.forEach((heading, index) => {
const id = heading.id || `heading-${index}`;
heading.id = id;

const text = heading.textContent;
const level = heading.tagName.toLowerCase();

if (level === 'h2') {
if (currentH2 !== null) {
tocHTML += '</ul></li>';
}
tocHTML += `<li><a href="#${id}" class="toc-link">${text}</a><ul>`;
                         currentH2 = index;
                         } else if (level === 'h3') {
                         tocHTML += `<li><a href="#${id}" class="toc-link">${text}</a></li>`;
                                                  }
                                                  });

if (currentH2 !== null) {
tocHTML += '</ul></li>';
}

if (rightTocList) rightTocList.innerHTML = tocHTML;
if (sidebarTocList) sidebarTocList.innerHTML = tocHTML;
}

function updateActiveTOC() {
const headings = document.querySelectorAll('#post-content h2, #post-content h3');
const tocLinks = document.querySelectorAll('.toc-link');

let currentActive = null;
const scrollPos = window.scrollY + 100;

headings.forEach((heading) => {
if (heading.offsetTop <= scrollPos) {
currentActive = heading.id;
}
});

tocLinks.forEach((link) => {
link.classList.remove('active');
if (link.getAttribute('href') === `#${currentActive}`) {
link.classList.add('active');
}
});
}

function setupSmoothScroll() {
document.querySelectorAll('.toc-link').forEach(link => {
link.addEventListener('click', (e) => {
e.preventDefault();
const targetId = link.getAttribute('href').slice(1);
const target = document.getElementById(targetId);
if (target) {
target.scrollIntoView({ behavior: 'smooth', block: 'start' });
history.pushState(null, null, `#${targetId}`);
}
});
});
}

document.addEventListener('DOMContentLoaded', () => {
generateTOC();
setupSmoothScroll();
updateActiveTOC();
});

let scrollTimeout;
window.addEventListener('scroll', () => {
if (scrollTimeout) clearTimeout(scrollTimeout);
scrollTimeout = setTimeout(updateActiveTOC, 50);
});
            </script>
            {% endif %}
        </div>

        <script src="{{ '/assets/js/theme.js' | relative_url }}"></script>
        <script src="{{ '/assets/js/mobile-menu.js' | relative_url }}"></script>
        <script src="{{ '/assets/js/repo-stats.js' | relative_url }}"></script>
    </body>
</html>
